name: Deploy to GitHub Pages

on:
  push:
    branches:
      - main # –∏–ª–∏ –≤–∞—à –æ—Å–Ω–æ–≤–Ω–æ–π branch

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout üõéÔ∏è
        uses: actions/checkout@v3

      - name: Setup Node.js üñ•Ô∏è
        uses: actions/setup-node@v3
        with:
          node-version: '18' # –∏–ª–∏ –¥—Ä—É–≥–∞—è –≤–µ—Ä—Å–∏—è Node.js, –∫–æ—Ç–æ—Ä—É—é –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ

      - name: Install dependencies üîß
        run: npm ci # –∏–ª–∏ yarn install, –µ—Å–ª–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ Yarn

      - name: Build project üèóÔ∏è
        run: npm run build # –∏–ª–∏ yarn build

      - name: Export project for static hosting üåê
        run: npm run export # –∏–ª–∏ yarn export
        # –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ next.config.js –¥–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä trailingSlash: true

      - name: Remove old artifacts üóëÔ∏è
        run: |
          gh api --method DELETE /repos/${{ github.repository }}/actions/artifacts | jq -r '.artifacts[].id' | xargs -I {} gh api --method DELETE /repos/${{ github.repository }}/actions/artifacts/{}
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Upload artifact üì¶
        uses: actions/upload-pages-artifact@v2
        with:
          path: ./out # –ø–∞–ø–∫–∞ —Å —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é .next)

      - name: Deploy to GitHub Pages üöÄ
        uses: actions/deploy-pages@v4